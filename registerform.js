let globalData = []

//object data 

function ObjectData(id , name , address, religion, hobby, gender) {
    this.id = id
    this.name = name ;
    this.address = address;
    this.religion= religion;
    this.hobby = hobby;
    this.gender = gender;
}

var mahasiswa1 = new ObjectData("1", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa2 = new ObjectData("2", "Hartono", "Bekasi", "Islam" , ["Sepeda" , "Renang"], "Laki-Laki")
var mahasiswa3 = new ObjectData("3", "Fadil", "Bogor", "Islam" , ["Basket" , "Renang"], "Laki-Laki")
var mahasiswa4 = new ObjectData("4", "Revina", "Surabaya", "Islam" , ["Sepeda" , "Renang"], "Perempuan")
var mahasiswa5 = new ObjectData("5", "Syifa", "Malang", "Islam" , "Renang", "Perempuan")
var mahasiswa6 = new ObjectData("6", "Ali", "Bekasi", "Islam" , ["Sepeda" , "Renang"], "Laki-Laki")
var mahasiswa7 = new ObjectData("7", "Nia", "Bandung", "Islam" , ["Sepeda" , "Renang"], "Perempuan")
var mahasiswa8 = new ObjectData("8","Zazam", "Semarang", "Islam" , ["Sepeda" , "Basket", "Badminton"], "Laki-Laki")
var mahasiswa9 = new ObjectData("9", "Denny", "Bogor", "Islam" , ["Sepeda" , "Badminton"], "Laki-Laki")
var mahasiswa10 = new ObjectData("10", "Dina", "Bogor", "Islam" , ["Sepeda" , "Badminton"], "Laki-Laki")
var mahasiswa11 = new ObjectData("11", "Riady", "Bekasi", "Islam" , ["Sepeda" , "Renang", "Basket"], "Laki-Laki")
var mahasiswa12 = new ObjectData("12", "Cinta", "Pekalongan", "Islam" , ["Sepeda" , "Renang" , "Football"], "Perempuan")
var mahasiswa13 = new ObjectData("13", "Laras", "Madiun", "Islam" , ["Sepeda" , "Renang"], "Laki-Laki")
var mahasiswa14 = new ObjectData("14", "Sarah", "DKI Jakarta", "Islam" , ["Sepeda" , "Badminton"], "Perempuan")
var mahasiswa15 = new ObjectData("15", "Tya", "DKI Jakarta", "Islam" , ["Sepeda" , "Basket"], "Perempuan")
var mahasiswa16 = new ObjectData("16", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa17 = new ObjectData("17", "Hartono", "Bekasi", "Islam" , ["Sepeda" , "Renang"], "Laki-Laki")
var mahasiswa18 = new ObjectData("18", "Fadil", "Bogor", "Islam" , ["Basket" , "Renang"], "Laki-Laki")
var mahasiswa19 = new ObjectData("19", "Revina", "Surabaya", "Islam" , ["Sepeda" , "Renang"], "Perempuan")
var mahasiswa20 = new ObjectData("20", "Syifa", "Malang", "Islam" , "Renang", "Perempuan")
var mahasiswa21 = new ObjectData("21", "Ali", "Bekasi", "Islam" , ["Sepeda" , "Renang"], "Laki-Laki")
var mahasiswa22 = new ObjectData("22", "Nia", "Bandung", "Islam" , ["Sepeda" , "Renang"], "Perempuan")
var mahasiswa23 = new ObjectData("23", "Zazam", "Semarang", "Islam" , ["Sepeda" , "Basket", "Badminton"], "Laki-Laki")
var mahasiswa24 = new ObjectData("24", "Denny", "Bogor", "Islam" , ["Sepeda" , "Badminton"], "Laki-Laki")
var mahasiswa25 = new ObjectData("25", "Dina", "Bogor", "Islam" , ["Sepeda" , "Badminton"], "Laki-Laki")
var mahasiswa26 = new ObjectData("26", "Riady", "Bekasi", "Islam" , ["Sepeda" , "Renang", "Basket"], "Laki-Laki")
var mahasiswa27 = new ObjectData("27", "Cinta", "Pekalongan", "Islam" , ["Sepeda" , "Renang" , "Football"], "Perempuan")
var mahasiswa28 = new ObjectData("28", "Laras", "Madiun", "Islam" , ["Sepeda" , "Renang"], "Laki-Laki")
var mahasiswa29 = new ObjectData("29", "Sarah", "DKI Jakarta", "Islam" , ["Sepeda" , "Badminton"], "Perempuan")
var mahasiswa30 = new ObjectData("30", "Tya", "DKI Jakarta", "Islam" , ["Sepeda" , "Basket"], "Perempuan")
var mahasiswa31 = new ObjectData("31","Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa32 = new ObjectData("32", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa33 = new ObjectData("33", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa34 = new ObjectData("34", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa35 = new ObjectData("35", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa36 = new ObjectData("36", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa37 = new ObjectData("37", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")
var mahasiswa38 = new ObjectData("38", "Asep Syafrudin", "DKI Jakarta", "Islam" , ["Badminton" , "Renang"], "Laki-Laki")


globalData.push(mahasiswa1);
globalData.push(mahasiswa2);
globalData.push(mahasiswa3);
globalData.push(mahasiswa4);
globalData.push(mahasiswa5);
globalData.push(mahasiswa6);
globalData.push(mahasiswa7);
globalData.push(mahasiswa8);
globalData.push(mahasiswa9);
globalData.push(mahasiswa10);
globalData.push(mahasiswa11);
globalData.push(mahasiswa12);
globalData.push(mahasiswa13);
globalData.push(mahasiswa14);
globalData.push(mahasiswa15);
globalData.push(mahasiswa16);
globalData.push(mahasiswa17);
globalData.push(mahasiswa18);
globalData.push(mahasiswa19);
globalData.push(mahasiswa20);
globalData.push(mahasiswa21);
globalData.push(mahasiswa22);
globalData.push(mahasiswa23);
globalData.push(mahasiswa24);
globalData.push(mahasiswa25);
globalData.push(mahasiswa26);
globalData.push(mahasiswa27);
globalData.push(mahasiswa28);
globalData.push(mahasiswa29);
globalData.push(mahasiswa30);
globalData.push(mahasiswa31);
globalData.push(mahasiswa32);
globalData.push(mahasiswa33);
globalData.push(mahasiswa34);
globalData.push(mahasiswa35);
globalData.push(mahasiswa36);
globalData.push(mahasiswa37);
globalData.push(mahasiswa38);


//make the pagination 
let currentPage = 1;
let total_data_per_page = 5;

const pagination = (e=1, data = globalData) => {
    let page = ""
    let totalPages = Math.ceil(data.length/total_data_per_page);
    let maxPagesShow = 5;
    currentPage = e;
    let startPage = 0;
    let endPage = 0;
    
    if(totalPages > 0) {
        if (totalPages <= maxPagesShow) {
            // total pages less than max so show all pages
            startPage = 1;
            endPage = totalPages;
        } else {
            // total pages more than max so calculate start and end pages
            let maxPagesBeforeCurrentPage = Math.floor(maxPagesShow / 2);
            let maxPagesAfterCurrentPage = Math.ceil(maxPagesShow / 2) - 1;
            if (currentPage <= maxPagesBeforeCurrentPage) {
                // current page near the start
                startPage = 1;
                endPage = maxPagesShow;
            } else if (currentPage + maxPagesAfterCurrentPage >= totalPages) {
                // current page near the end
                startPage = totalPages - maxPagesShow + 1;
                endPage = totalPages;
            } else {
                // current page somewhere in the middle
                startPage = currentPage - maxPagesBeforeCurrentPage;
                endPage = currentPage + maxPagesAfterCurrentPage;
            }
        }
        page += `
            <li class="page-item">
                    <a class="page-link" onclick="prevpage(checkFilter())" tabindex="-1">Previous</a>
            </li>
        `
    
        for (let i = startPage ; i <= endPage; i++) {
            page += `
            <li class="page-item"><a class="page-link" onclick="newshow(${i}, checkFilter())">${i}</a></li>
            `
        }  
        page += `
            <li class="page-item">
                    <a class="page-link" onclick="nextpage(checkFilter())" tabindex="-1">Last</a>
            </li>
        `
        document.querySelector(".pagination").innerHTML = page;
    } else{
        document.querySelector(".pagination").innerHTML=" ";
    }
    
}

const nextpage = (data = globalData) => {
        currentPage = Math.ceil(data.length / total_data_per_page);
        newshow(currentPage , data);
}

const prevpage = (data = globalData) => {
        newshow(1 , data);
}
// fn to generate row table from data

const getEl = el => {
    return document.querySelector(el)
}

// const showData = (dataShow = globalData) => {
//     const table = getEl("table[type=listData] tbody")
    
//     const listData = dataShow.map((value, index) => {
//         return `
//         <tr>
//         <th scope="row">${index + 1}</th>
//         <td>${value.name}</td>
//                 <td>${value.address}</td>
//                 <td>${value.religion}</td>
//                 <td>${value.hobby}</td>
//                 <td>${value.gender}</td>
//                 <td align="center">
//                     <button index="${index}" onclick="updateData(this)">Ubah</button>
//                 </td>
//                 <td align = "center">
//                     <button index="${index}" onclick="deleteData(this)">Hapus</button>
//                 </td>
//             </tr>
//         `
//     })

//     table.innerHTML = listData.join("")
// }

//show data
// fn to save data

const saveData = (data = globalData) => {
    event.preventDefault()
    let startIdUser = globalData.length+1;
    const form = document.inputData
    // if ? value true : value false
    let idUser = form.idUser.value ? form.idUser.value : startIdUser ;
    if (idUser == form.idUser.value) {
        for (let index = 0; index < globalData.length; index++) {
            if(globalData[index].id == idUser) {
                globalData[index].name = form.name.value;
                globalData[index].address = form.address.value;
                globalData[index].religion = form.religion.value;
                globalData[index].hobby = getValueCheckbox("hobby[]");
                globalData[index].gender = form.gender.value;

                form.idUser.removeAttribute('value');
                break;
            } 
        }
    } else {
        let newData = new ObjectData(
            idUser , 
            form.name.value , 
            form.address.value , 
            form.religion.value , 
            getValueCheckbox("hobby[]"), 
            form.gender.value
        )
        globalData.push(newData);
    }

    //for checking the data if null which one to show.
    if(data.length !== 0) {
        newshow(currentPage, data);
    } else {
        newshow(currentPage,globalData);
    }
   
    form.reset()
}

// get values from checkboxes
const getValueCheckbox = el => {
    const els = document.querySelectorAll("input[name='" + el + "']:checked")
    let values = []
    els.forEach(value => values.push(value.value))
    return values
}

// set values to checkboxes
const setValueCheckbox = (el, values) => {
    const els = document.querySelectorAll("input[name='" + el + "']")

    els.forEach(input => {
        input.checked = values.indexOf(input.value) != -1 ? "checked" : ""
    })
}

// set form's values
const updateData = (el, data=globalData) => {
    el.closest("tr").style.backgroundColor = "red";
    const indexData = el.getAttribute("index")
    const selectedData = data[indexData]
    const form = document.inputData

    //updating data in global data
    form.idUser.value = selectedData.id
    form.name.value = selectedData.name
    form.gender.value = selectedData.gender
    form.religion.value = selectedData.religion
    form.address.value = selectedData.address
    form.index.value = indexData

    //set value in form 
    setValueCheckbox("hobby[]", selectedData.hobby)
}

// delete data
const deleteData = async (el , data = globalData) => {
    const idData = el.id;
    for (let index = 0; index < globalData.length; index++) {
        if (globalData[index].id == idData) {
            await globalData.splice(index , 1);
        }        
    }
    //for delete array in data array when search feature is running
    for (let index = 0; index < data.length; index++) {
        if (data[index].id == idData) {
            await data.splice(index , 1);
        }     
    }
    //show pagination after delete data , it wil check current total page
    let totalPages = Math.ceil(data.length/total_data_per_page);
    if(currentPage >= totalPages) {
        currentPage = totalPages;
        newshow(currentPage, data);
    } else {
        newshow(currentPage, data);
    }
}

// fn to filter data using typed value
const filterData = self => {
    const valueSearch = self.value.toLowerCase();

    const filteredData = globalData.filter(value => {
        const nameData = value.name.toLowerCase();
        const addressData = value.name.toLowerCase();
        return nameData.includes(valueSearch) || addressData.includes(valueSearch)
    })
    return filteredData;
}

//search data 
const searchData = self => {
    newshow(1, filterData(self));
}

//function to show the data
const show5data = function (page , data = globalData) {
    if (page > 0) {
        var total_tr ="";
        for(index = (page-1)*total_data_per_page; index<(page * total_data_per_page) && index < data.length; index++) {
            
            total_tr += `
            <tr>
            <th scope="row">${index + 1}</th>
            <td>${data[index].name}</td>
            <td>${data[index].address}</td>
            <td>${data[index].religion}</td>
            <td>${data[index].hobby}</td>
            <td>${data[index].gender}</td>
            <td align="center">
            <button index="${index}" onclick="updateData(this, checkFilter())">Ubah</button>
            </td>
            <td align = "center">
                <button index="${index}" id="${data[index].id}" onclick="deleteData(this, checkFilter())">Hapus</button>
                </td>
                </tr>
                `   
            }
            pagination(page, data);
    }
    return total_tr;
}

//function to call the show function
 async function newshow(page , data) {
    const table = getEl("table[type=listData] tbody")
    if(show5data(page , data ) === undefined) {
        table.innerHTML =""
    } else {
        let tr = show5data(page, data); 
        table.innerHTML = tr;
    }
}

//initialization the first page to show
function init() {
    newshow(1)
}
init() //show the first page
    
/*untuk mengecek apakah search box berisi suatu nilai 
untuk di cari sehingga data yang di tampilkan pada pagination bisa sesuai 
**/

function checkFilter(){
    let key = document.querySelector("#mySearch");
    let arraySearch = filterData(key);
    return arraySearch;    
}

/**
 * TUGAS:
 *      - Tambah action edit dan delete pada List data latihan sebelumnya
 *      - Lakukan perubahan pada form:
 *          - Jenis kelamin menggunakan Radio
 *          - Hobi menggunakan checkbox (Membaca, Tiduran, Badminton, Main Bola, Futsal)
 *          - Agama menggunakan Dropdown List (select - option)
 *      - Ketika klik edit pada List data, maka form akan otomatis terisi data sesuai dengan data yang dipilih
 *
 *
 * Latihan:
 *      - Tambahin pagination di bawah table (seperti pagination ada google search)
 *      - Setiap halaman menampilkan 5 data
 *      - Buat default data sebanyak 15 data
 */
